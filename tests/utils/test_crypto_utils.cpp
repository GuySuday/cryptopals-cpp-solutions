#include <gtest/gtest.h>

#include <vector> // std::vector
#include <string> // std::string
#include <tuple> // std::tuple

#include "utils/crypto_utils.hpp"
#include "utils/base_conversions.hpp"
#include "utils/types.hpp" // bit, byte, uint

class HammingDistanceTestFixture : public ::testing::TestWithParam<std::tuple<std::string, std::string, uint>> {};
TEST_P(HammingDistanceTestFixture, hamming_distance_)
{
    std::string bits1_str = std::get<0>(GetParam());
    std::string bits2_str = std::get<1>(GetParam());
    uint expected_difference = std::get<2>(GetParam());

    std::vector<bit> bits1(bits1_str.begin(), bits1_str.end());
    std::vector<bit> bits2(bits2_str.begin(), bits2_str.end());
    uint difference = crypto_utils::hamming_distance(bits1, bits2);
    EXPECT_EQ(difference, expected_difference);
}

INSTANTIATE_TEST_SUITE_P(
    CryptoUtils,
    HammingDistanceTestFixture,
    ::testing::Values(
        std::make_tuple("", "", 0),
        std::make_tuple("010", "010", 0),
        std::make_tuple("10", "11", 1),
        std::make_tuple("0111010001101000011010010111001100100000011010010111001100100000011000010010000001110100011001010111001101110100", "0111011101101111011010110110101101100001001000000111011101101111011010110110101101100001001000010010000100100001", 37)
    )
);

TEST(CryptoUtils, aes_ecb_decrypt)
{
    std::string ciphertext_str = "091230aade3eb330dbaa4358f88d2a6c37b72d0cf4c22c344aec4142d00ce530dd31b8c2303fef7a75035bd04b3c45ce0db93a6b8f2831b018e830d9b2e2db734b91f5ca7d850d10406013cb20844aad8d4acbe1c79cca94bb7376c9df2b9103e6caca8caec5cf8437f3fb6d77eb2d2fff569c3ce526f028ed606c8c8e5825cda098061ac8d7e6096da585913f64b1b40810f668fc345b8d7b4186f870020e5bdda3611889e0f4ec0411c37bca38270a9a51a73aaea762f37de46f200e57f63644c6cdd280dbf51abcb911ef6eba9025a26279ab3012d324814b773f94ed81e87b27e844e93474b87a2df16cc7c8028d6d4587a22ff9cdc442522a6f54e60ba0165794dbb8aa7c28099452060bc2c13773dc26eca7f3f6c1707cb62cfa97dacbd9b2e106dd77431ca186ed07d3e24a8fab2849e5f9643d51a62969f67711d6d1d6f3ebaead02b25cde3129e1a368a2ce7a3af6c43230f9a585ec6b33538a898570675d321450d51f465c04a52e8565cb0ccde990177d1ecd22477e95bb0d51f3c222f27a24c944aa15530a38dcf5eea672570e6532b026b69d0cff884c32a2bea43de90bbf572c9b53dad8b6666c0f548f3cfccdbfe0157b50a8100de3303cff0b7455fa0eb0467072c68b39650fb45fd1cb756194ac1713b8061ff6db4a1008290a8caaa52412e719dc73c7015a7b6429f73b1ebe739409dd4bfc57b2fb4a9ae87cf14de85fa47c3338cc0739f5da39b70803a029426f1c46d0bd7d4c11878983f70b281e6351cb32b5fa2aaca925f1495b93bdc0d205d2a7ce0b6956160c1ac8ec2ae35c5d152096d3f10149cedc270dcdd3a59386b5b92e29803ade4bf5cec8938608c6ed0af496700317dc5384a162ee9eb989962cff7cfaabd19c8ad791e3ee812f5348e24e1f3294a0e71bd7f29877d35914711ca79f037faad7162cfd0d2abcd2b47929fb3e33e56eab967acd8f7cfd23f403a51122bf4d16ef82b3dfe07feab84d1c2c3b344c8cc43324bf1fed35cf1071f6faa11ca432b3ff9a44d1cbeb807afadd72aee176f32c2381cf40e8140c37be4bb11b026ae02a7192df9e0adc52294ccdb57327fe66cfa8f978359349f32ccca931523834b86d84c168dfee41870e005dcd05815de71f53cc80285ba6a2d776bc87fb3d8b91655512437b671eb50840aeb21506ab85d0bd2651731634f14a91a40406cc69302621ee9a7b625c8236875ed769398d8d7f95cf2340b409f8424774274ce6ddde991ce43e0343e1aece361a08914512d91d68115d6da038fd883cc6545c0ebd6cade06cc0f577714f7df7254fe7f26f8dea1b36dcc05c674f3a929f6b2465716797fcd23473dd972353acd68d1f6e711ca36ecb959f5b78109126e80eca6879b5de6d2fc0dfcee0a6138a263768edec89aca336bacd0699f539e2eff5452778b482771714aa346f3ab740e4d62fdb91dbe30905088842fd8db37bf90dca2b3a16b5ed4ad723282d70f4a83c3b6e555c1d459a9bbee27ce96cd749f4b5da845ef08ce3d737a762c552a9cf04d88c414348c68c85a4ce4c26aa26283defadb8c2fefd5116c282ccb3c1a0bb61746d6d3b2d6c5b8414179edee5bb077c57c3bda6ca6336052dae3d0e4d23099a71b86d6bc682450106a88674efc62bace9592236abde56d30a8e68ea76db0eaf5bbe2962ad61bf4a058836e737a569790ac711720410369ee82c182b4a4424bfd02365872f8ac9ebf3d4f18e8c413b463dde3829e13d782e7570590571de5ddde92d7096c72275579a336e04fc9b52f24f5702f812a0a0a3ca2aac6b004ccd271708844293a9ea5fc65a254deb6742de38c4d4c3a302e1d0be698f52ac2bcd42e6f5f6605db495303813aa19d7dde48a2a42468be837ce926a67b02b393ee2db19905585a8792fcec863bafa4c1d55eca6e85c7f0f64861cd7395e98c646534a3bf9eb716561e0a5d797e896c922cde2940cd8ab0fc7cfae67a3b794c5c0e0d5a39ac5e9ae3ea9d8446856e8fbe365bc00b5f40f9687e10748d31ede5b465cc5d7bae7f6affac3395cd6cb29db199e1735e8c5f7e910b00157afb28f781f43f6f1201f4d5a37592b4f115fdae39bd09c06545079366b0faed26105aa4694f9b7bcdc5439f1d6ced97df2c15a6fef5cb7cfccc69060427811fa1db92bad8ec857bd1f954113ecd9359c17b3ac684e1cb1e74a50616ea3d0d87c5207143360fb53f2ae5589d09fd7d0f76e02e099fae412b0cfdec7fbdf5e9e99dfd9e0ab87b1517a0fb4022a69fac331df12b80b7211987263d57d2e9daa3500db97a248dfd6c3cfeea90e68c9da3967a4c09ecd12bcf5c1b5d48aa2516bc83f11e3a224f582e1f5ba4e2c4363dcd49e338c936c660a090dc3c16dfb2ce2402a509bd0c856f35ac861b55780bf776683050434884d2bf7ab8e9830d812116b2cd8c34d358c0205e5ceeb620dfca3ac7761d02d537777429bb01b9c437ce0f1cdf2f7c84290af8f02fcaab123ceee1b0ca0e87e6073601c2d4f4962de50a031680bb3c5c5c137455a9ceff526f49b3d5fd532ae21237ed5adf3afed1321bb17db561b118d119a3730ec9dc17ffb8edc28c50139c9b1635a776a2e9f035779da2d0b21fc5cfc2674d81ef391ef6bee8b0ff1e43e4f16e5d5d1a495be6c395a76f4f6afc1a304b5e16ce81c7e9e91a59b87bf31972a67fcbfccfa7208117d4e9774da54ea88c6f5d9dac8e6f3ac51cf411da0715fba949e91d0542c2aa9b71a45a41b21645bdab941fc133ef003bc232fae465656747fbe14ecc255bbd4b0b19760b0b9a7b10bebe67da88cd34112ffaa286db0a5461399645a45ce440a550d7e1ce1f220dd1c8b25e9e74e7b039146b36205acb5342ce57f3d5c8fa56561841433d6c3132aabc0ee34d1740da6814ec68e1fc5475df801e60818476f2091f35fc2e8b4131b625006f8f2906e299a8aa760fc43c9e882106f8914798fd482fe8e081d8d684b5906adb25ad6c6e112125dcf12cac090c17b82dd1d04b8275ac735726ce7b46d6b957562fc7b364c053747112631258316e6d28af2d64aa663fd77c65b05693fa7ec9ec7f1a58dddde1fdf4f10eeed4f0675d685450849fb464e771ea7449516deeeb19e11f799855193cf0432da44a4aad22167d7a6180350f6747f86a04737a1927f6fb730a636316741bd3fb219ea4e1e0ca3ff28a2699bb014d428f612effd684028b5d900018c90edf8bc946a7fb88b0bc28b4934214207be4db5dfcd6f0b48b1603671cd8eb8fb1c7f44d203fa2a65833abd3c36608dcf0bee3320fb6fa6af13d2e7a7bbd66e44db3b9f67877e9c58c883e7470ff4a134fcd5a578b3455504473b4bb9a93c02c6a1dffcafc0eac7d6628430c182d7feaa7ef6548052c91f9574129d27d8afc56ecd1596310d20df1c8e408a746f1a06779f121213755ec25635dc8af43a79f91b39009f91f7305a9681142f2d0ffcde6d7144f89b215b5e83e045973274a6ffd1dc1b01efb65023d38af0ad9e6d46f0207f5211f3792aaa24efa9f10d723edd742170b4d66b40aec4261801e53af5b4115c6fd2273d1b52dca62d7981e5dc7591f6df04d98184f081ab4b5b1089bc5a2bf0b490a6ea22b2a99e9c2da0e2ec64f35b3f0e8ada3a64a3d35e640c7b3d81666a64780f9d0ab738042d071a12c8b9682ced320edfa7598aea28f230a2112b034a2181da8114552cd8102e0fd64cacc655b5b0aba910690c80af0402517a38b91b72cc631a29b4c6e1d9ecd4e141d60ecd0a23dbeacd65bf4fe51c5005e87c28615fc53d22ffa62af1c834816ff151440dcf21f9af19f3141855569724bbf8eef7979a08247c6e689ad1e047a7cc0bb802fa5ae5df95ba261b335d1a2da55e8153ef167e2908fe14fcd6dbc383930855f61ca9961225410743b727dc705d6a7137556be420e2ef916a361c580a381227358e503df86357407dc8f9ed520d9905445b273c4dc87cbe0f4c9c718239f3a346aa74546c804b5e40543d904b557a7e1462989495c93e90b866fcb4a46c97637e6b65f37b7eaf80c870ed72bbce1fff8c2d87";
    std::string key_str = "YELLOW SUBMARINE";
    std::string expected_plaintext_str = "49276d206261636b20616e642049276d2072696e67696e27207468652062656c6c200a4120726f636b696e27206f6e20746865206d696b65207768696c652074686520666c79206769726c732079656c6c200a496e206563737461737920696e20746865206261636b206f66206d65200a57656c6c20746861742773206d7920444a204465736861792063757474696e2720616c6c207468656d205a2773200a48697474696e27206861726420616e6420746865206769726c69657320676f696e27206372617a79200a56616e696c6c612773206f6e20746865206d696b652c206d616e2049276d206e6f74206c617a792e200a0a49276d206c657474696e27206d792064727567206b69636b20696e200a497420636f6e74726f6c73206d79206d6f75746820616e64204920626567696e200a546f206a757374206c657420697420666c6f772c206c6574206d7920636f6e636570747320676f200a4d7920706f737365277320746f2074686520736964652079656c6c696e272c20476f2056616e696c6c6120476f21200a0a536d6f6f74682027636175736520746861742773207468652077617920492077696c6c206265200a416e6420696620796f7520646f6e2774206769766520612064616d6e2c207468656e200a57687920796f752073746172696e27206174206d65200a536f20676574206f666620276361757365204920636f6e74726f6c20746865207374616765200a54686572652773206e6f2064697373696e2720616c6c6f776564200a49276d20696e206d79206f776e207068617365200a546865206769726c69657320736120792074686579206c6f7665206d6520616e642074686174206973206f6b200a416e6420492063616e2064616e636520626574746572207468616e20616e79206b6964206e2720706c6179200a0a53746167652032202d2d2059656120746865206f6e65207961272077616e6e61206c697374656e20746f200a49742773206f6666206d79206865616420736f206c657420746865206265617420706c6179207468726f756768200a536f20492063616e2066756e6b20697420757020616e64206d616b6520697420736f756e6420676f6f64200a312d322d3320596f202d2d204b6e6f636b206f6e20736f6d6520776f6f64200a466f7220676f6f64206c75636b2c2049206c696b65206d79207268796d6573206174726f63696f7573200a537570657263616c6166726167696c697374696365787069616c69646f63696f7573200a49276d20616e2065666665637420616e64207468617420796f752063616e20626574200a492063616e2074616b65206120666c79206769726c20616e64206d616b6520686572207765742e200a0a49276d206c696b652053616d736f6e202d2d2053616d736f6e20746f2044656c696c6168200a54686572652773206e6f2064656e79696e272c20596f752063616e2074727920746f2068616e67200a42757420796f75276c6c206b65657020747279696e2720746f20676574206d79207374796c65200a4f76657220616e64206f7665722c207072616374696365206d616b65732070657266656374200a427574206e6f7420696620796f752772652061206c6f616665722e200a0a596f75276c6c20676574206e6f77686572652c206e6f20706c6163652c206e6f2074696d652c206e6f206769726c73200a536f6f6e202d2d204f68206d7920476f642c20686f6d65626f64792c20796f752070726f6261626c7920656174200a537061676865747469207769746820612073706f6f6e2120436f6d65206f6e20616e642073617920697421200a0a5649502e2056616e696c6c6120496365207965702c207965702c2049276d20636f6d696e272068617264206c696b652061207268696e6f200a496e746f7869636174696e6720736f20796f752073746167676572206c696b6520612077696e6f200a536f2070756e6b732073746f7020747279696e6720616e64206769726c2073746f7020637279696e27200a56616e696c6c61204963652069732073656c6c696e2720616e6420796f752070656f706c652061726520627579696e27200a274361757365207768792074686520667265616b7320617265206a6f636b696e27206c696b65204372617a7920476c7565200a4d6f76696e2720616e642067726f6f76696e2720747279696e6720746f2073696e6720616c6f6e67200a416c6c207468726f756768207468652067686574746f2067726f6f76696e272074686973206865726520736f6e67200a4e6f7720796f7527726520616d617a6564206279207468652056495020706f7373652e200a0a5374657070696e2720736f2068617264206c696b652061204765726d616e204e617a69200a53746172746c6564206279207468652062617365732068697474696e272067726f756e64200a54686572652773206e6f207472697070696e27206f6e206d696e652c2049276d206a7573742067657474696e2720646f776e200a537061726b616d617469632c2049276d2068616e67696e27207469676874206c696b6520612066616e61746963200a596f752074726170706564206d65206f6e636520616e6420492074686f756768742074686174200a596f75206d696768742068617665206974200a536f207374657020646f776e20616e64206c656e64206d6520796f757220656172200a27383920696e206d792074696d652120596f752c20273930206973206d7920796561722e200a0a596f75277265207765616b656e696e2720666173742c20594f2120616e6420492063616e2074656c6c206974200a596f757220626f647927732067657474696e2720686f742c20736f2c20736f20492063616e20736d656c6c206974200a536f20646f6e2774206265206d616420616e6420646f6e277420626520736164200a27436175736520746865206c79726963732062656c6f6e6720746f204943452c20596f752063616e2063616c6c206d6520446164200a596f75277265207069746368696e272061206669742c20736f2073746570206261636b20616e6420656e64757265200a4c65742074686520776974636820646f63746f722c204963652c20646f207468652064616e636520746f2063757265200a536f20636f6d6520757020636c6f736520616e6420646f6e277420626520737175617265200a596f752077616e6e6120626174746c65206d65202d2d20416e7974696d652c20616e797768657265200a0a596f752074686f756768742074686174204920776173207765616b2c20426f792c20796f7527726520646561642077726f6e67200a536f20636f6d65206f6e2c206576657279626f647920616e642073696e67207468697320736f6e67200a0a536179202d2d20506c617920746861742066756e6b79206d75736963205361792c20676f20776869746520626f792c20676f20776869746520626f7920676f200a706c617920746861742066756e6b79206d7573696320476f20776869746520626f792c20676f20776869746520626f792c20676f200a4c617920646f776e20616e6420626f6f67696520616e6420706c617920746861742066756e6b79206d757369632074696c6c20796f75206469652e200a0a506c617920746861742066756e6b79206d7573696320436f6d65206f6e2c20436f6d65206f6e2c206c6574206d652068656172200a506c617920746861742066756e6b79206d7573696320776869746520626f7920796f75207361792069742c20736179206974200a506c617920746861742066756e6b79206d757369632041206c6974746c65206c6f75646572206e6f77200a506c617920746861742066756e6b79206d757369632c20776869746520626f7920436f6d65206f6e2c20436f6d65206f6e2c20436f6d65206f6e200a506c617920746861742066756e6b79206d75736963200a04040404";

    std::vector<byte> ciphertext_data = base_conversions::hex_to_bytes(ciphertext_str);
    std::vector<byte> key(key_str.begin(), key_str.end());
    std::vector<byte> plaintext_data = crypto_utils::aes_ecb_decrypt(ciphertext_data, key, 128);
    std::string plaintext_hex = base_conversions::bytes_to_hex(plaintext_data);
    EXPECT_EQ(plaintext_hex, expected_plaintext_str);
}

TEST(CryptoUtils, aes_ecb_encrypt)
{
    // TODO: should we remove padding?
    std::string plaintext_str = "49276d206261636b20616e642049276d2072696e67696e27207468652062656c6c200a4120726f636b696e27206f6e20746865206d696b65207768696c652074686520666c79206769726c732079656c6c200a496e206563737461737920696e20746865206261636b206f66206d65200a57656c6c20746861742773206d7920444a204465736861792063757474696e2720616c6c207468656d205a2773200a48697474696e27206861726420616e6420746865206769726c69657320676f696e27206372617a79200a56616e696c6c612773206f6e20746865206d696b652c206d616e2049276d206e6f74206c617a792e200a0a49276d206c657474696e27206d792064727567206b69636b20696e200a497420636f6e74726f6c73206d79206d6f75746820616e64204920626567696e200a546f206a757374206c657420697420666c6f772c206c6574206d7920636f6e636570747320676f200a4d7920706f737365277320746f2074686520736964652079656c6c696e272c20476f2056616e696c6c6120476f21200a0a536d6f6f74682027636175736520746861742773207468652077617920492077696c6c206265200a416e6420696620796f7520646f6e2774206769766520612064616d6e2c207468656e200a57687920796f752073746172696e27206174206d65200a536f20676574206f666620276361757365204920636f6e74726f6c20746865207374616765200a54686572652773206e6f2064697373696e2720616c6c6f776564200a49276d20696e206d79206f776e207068617365200a546865206769726c69657320736120792074686579206c6f7665206d6520616e642074686174206973206f6b200a416e6420492063616e2064616e636520626574746572207468616e20616e79206b6964206e2720706c6179200a0a53746167652032202d2d2059656120746865206f6e65207961272077616e6e61206c697374656e20746f200a49742773206f6666206d79206865616420736f206c657420746865206265617420706c6179207468726f756768200a536f20492063616e2066756e6b20697420757020616e64206d616b6520697420736f756e6420676f6f64200a312d322d3320596f202d2d204b6e6f636b206f6e20736f6d6520776f6f64200a466f7220676f6f64206c75636b2c2049206c696b65206d79207268796d6573206174726f63696f7573200a537570657263616c6166726167696c697374696365787069616c69646f63696f7573200a49276d20616e2065666665637420616e64207468617420796f752063616e20626574200a492063616e2074616b65206120666c79206769726c20616e64206d616b6520686572207765742e200a0a49276d206c696b652053616d736f6e202d2d2053616d736f6e20746f2044656c696c6168200a54686572652773206e6f2064656e79696e272c20596f752063616e2074727920746f2068616e67200a42757420796f75276c6c206b65657020747279696e2720746f20676574206d79207374796c65200a4f76657220616e64206f7665722c207072616374696365206d616b65732070657266656374200a427574206e6f7420696620796f752772652061206c6f616665722e200a0a596f75276c6c20676574206e6f77686572652c206e6f20706c6163652c206e6f2074696d652c206e6f206769726c73200a536f6f6e202d2d204f68206d7920476f642c20686f6d65626f64792c20796f752070726f6261626c7920656174200a537061676865747469207769746820612073706f6f6e2120436f6d65206f6e20616e642073617920697421200a0a5649502e2056616e696c6c6120496365207965702c207965702c2049276d20636f6d696e272068617264206c696b652061207268696e6f200a496e746f7869636174696e6720736f20796f752073746167676572206c696b6520612077696e6f200a536f2070756e6b732073746f7020747279696e6720616e64206769726c2073746f7020637279696e27200a56616e696c6c61204963652069732073656c6c696e2720616e6420796f752070656f706c652061726520627579696e27200a274361757365207768792074686520667265616b7320617265206a6f636b696e27206c696b65204372617a7920476c7565200a4d6f76696e2720616e642067726f6f76696e2720747279696e6720746f2073696e6720616c6f6e67200a416c6c207468726f756768207468652067686574746f2067726f6f76696e272074686973206865726520736f6e67200a4e6f7720796f7527726520616d617a6564206279207468652056495020706f7373652e200a0a5374657070696e2720736f2068617264206c696b652061204765726d616e204e617a69200a53746172746c6564206279207468652062617365732068697474696e272067726f756e64200a54686572652773206e6f207472697070696e27206f6e206d696e652c2049276d206a7573742067657474696e2720646f776e200a537061726b616d617469632c2049276d2068616e67696e27207469676874206c696b6520612066616e61746963200a596f752074726170706564206d65206f6e636520616e6420492074686f756768742074686174200a596f75206d696768742068617665206974200a536f207374657020646f776e20616e64206c656e64206d6520796f757220656172200a27383920696e206d792074696d652120596f752c20273930206973206d7920796561722e200a0a596f75277265207765616b656e696e2720666173742c20594f2120616e6420492063616e2074656c6c206974200a596f757220626f647927732067657474696e2720686f742c20736f2c20736f20492063616e20736d656c6c206974200a536f20646f6e2774206265206d616420616e6420646f6e277420626520736164200a27436175736520746865206c79726963732062656c6f6e6720746f204943452c20596f752063616e2063616c6c206d6520446164200a596f75277265207069746368696e272061206669742c20736f2073746570206261636b20616e6420656e64757265200a4c65742074686520776974636820646f63746f722c204963652c20646f207468652064616e636520746f2063757265200a536f20636f6d6520757020636c6f736520616e6420646f6e277420626520737175617265200a596f752077616e6e6120626174746c65206d65202d2d20416e7974696d652c20616e797768657265200a0a596f752074686f756768742074686174204920776173207765616b2c20426f792c20796f7527726520646561642077726f6e67200a536f20636f6d65206f6e2c206576657279626f647920616e642073696e67207468697320736f6e67200a0a536179202d2d20506c617920746861742066756e6b79206d75736963205361792c20676f20776869746520626f792c20676f20776869746520626f7920676f200a706c617920746861742066756e6b79206d7573696320476f20776869746520626f792c20676f20776869746520626f792c20676f200a4c617920646f776e20616e6420626f6f67696520616e6420706c617920746861742066756e6b79206d757369632074696c6c20796f75206469652e200a0a506c617920746861742066756e6b79206d7573696320436f6d65206f6e2c20436f6d65206f6e2c206c6574206d652068656172200a506c617920746861742066756e6b79206d7573696320776869746520626f7920796f75207361792069742c20736179206974200a506c617920746861742066756e6b79206d757369632041206c6974746c65206c6f75646572206e6f77200a506c617920746861742066756e6b79206d757369632c20776869746520626f7920436f6d65206f6e2c20436f6d65206f6e2c20436f6d65206f6e200a506c617920746861742066756e6b79206d75736963200a04040404";
    std::string key_str = "YELLOW SUBMARINE";
    std::string expected_ciphertext_str = "091230aade3eb330dbaa4358f88d2a6c37b72d0cf4c22c344aec4142d00ce530dd31b8c2303fef7a75035bd04b3c45ce0db93a6b8f2831b018e830d9b2e2db734b91f5ca7d850d10406013cb20844aad8d4acbe1c79cca94bb7376c9df2b9103e6caca8caec5cf8437f3fb6d77eb2d2fff569c3ce526f028ed606c8c8e5825cda098061ac8d7e6096da585913f64b1b40810f668fc345b8d7b4186f870020e5bdda3611889e0f4ec0411c37bca38270a9a51a73aaea762f37de46f200e57f63644c6cdd280dbf51abcb911ef6eba9025a26279ab3012d324814b773f94ed81e87b27e844e93474b87a2df16cc7c8028d6d4587a22ff9cdc442522a6f54e60ba0165794dbb8aa7c28099452060bc2c13773dc26eca7f3f6c1707cb62cfa97dacbd9b2e106dd77431ca186ed07d3e24a8fab2849e5f9643d51a62969f67711d6d1d6f3ebaead02b25cde3129e1a368a2ce7a3af6c43230f9a585ec6b33538a898570675d321450d51f465c04a52e8565cb0ccde990177d1ecd22477e95bb0d51f3c222f27a24c944aa15530a38dcf5eea672570e6532b026b69d0cff884c32a2bea43de90bbf572c9b53dad8b6666c0f548f3cfccdbfe0157b50a8100de3303cff0b7455fa0eb0467072c68b39650fb45fd1cb756194ac1713b8061ff6db4a1008290a8caaa52412e719dc73c7015a7b6429f73b1ebe739409dd4bfc57b2fb4a9ae87cf14de85fa47c3338cc0739f5da39b70803a029426f1c46d0bd7d4c11878983f70b281e6351cb32b5fa2aaca925f1495b93bdc0d205d2a7ce0b6956160c1ac8ec2ae35c5d152096d3f10149cedc270dcdd3a59386b5b92e29803ade4bf5cec8938608c6ed0af496700317dc5384a162ee9eb989962cff7cfaabd19c8ad791e3ee812f5348e24e1f3294a0e71bd7f29877d35914711ca79f037faad7162cfd0d2abcd2b47929fb3e33e56eab967acd8f7cfd23f403a51122bf4d16ef82b3dfe07feab84d1c2c3b344c8cc43324bf1fed35cf1071f6faa11ca432b3ff9a44d1cbeb807afadd72aee176f32c2381cf40e8140c37be4bb11b026ae02a7192df9e0adc52294ccdb57327fe66cfa8f978359349f32ccca931523834b86d84c168dfee41870e005dcd05815de71f53cc80285ba6a2d776bc87fb3d8b91655512437b671eb50840aeb21506ab85d0bd2651731634f14a91a40406cc69302621ee9a7b625c8236875ed769398d8d7f95cf2340b409f8424774274ce6ddde991ce43e0343e1aece361a08914512d91d68115d6da038fd883cc6545c0ebd6cade06cc0f577714f7df7254fe7f26f8dea1b36dcc05c674f3a929f6b2465716797fcd23473dd972353acd68d1f6e711ca36ecb959f5b78109126e80eca6879b5de6d2fc0dfcee0a6138a263768edec89aca336bacd0699f539e2eff5452778b482771714aa346f3ab740e4d62fdb91dbe30905088842fd8db37bf90dca2b3a16b5ed4ad723282d70f4a83c3b6e555c1d459a9bbee27ce96cd749f4b5da845ef08ce3d737a762c552a9cf04d88c414348c68c85a4ce4c26aa26283defadb8c2fefd5116c282ccb3c1a0bb61746d6d3b2d6c5b8414179edee5bb077c57c3bda6ca6336052dae3d0e4d23099a71b86d6bc682450106a88674efc62bace9592236abde56d30a8e68ea76db0eaf5bbe2962ad61bf4a058836e737a569790ac711720410369ee82c182b4a4424bfd02365872f8ac9ebf3d4f18e8c413b463dde3829e13d782e7570590571de5ddde92d7096c72275579a336e04fc9b52f24f5702f812a0a0a3ca2aac6b004ccd271708844293a9ea5fc65a254deb6742de38c4d4c3a302e1d0be698f52ac2bcd42e6f5f6605db495303813aa19d7dde48a2a42468be837ce926a67b02b393ee2db19905585a8792fcec863bafa4c1d55eca6e85c7f0f64861cd7395e98c646534a3bf9eb716561e0a5d797e896c922cde2940cd8ab0fc7cfae67a3b794c5c0e0d5a39ac5e9ae3ea9d8446856e8fbe365bc00b5f40f9687e10748d31ede5b465cc5d7bae7f6affac3395cd6cb29db199e1735e8c5f7e910b00157afb28f781f43f6f1201f4d5a37592b4f115fdae39bd09c06545079366b0faed26105aa4694f9b7bcdc5439f1d6ced97df2c15a6fef5cb7cfccc69060427811fa1db92bad8ec857bd1f954113ecd9359c17b3ac684e1cb1e74a50616ea3d0d87c5207143360fb53f2ae5589d09fd7d0f76e02e099fae412b0cfdec7fbdf5e9e99dfd9e0ab87b1517a0fb4022a69fac331df12b80b7211987263d57d2e9daa3500db97a248dfd6c3cfeea90e68c9da3967a4c09ecd12bcf5c1b5d48aa2516bc83f11e3a224f582e1f5ba4e2c4363dcd49e338c936c660a090dc3c16dfb2ce2402a509bd0c856f35ac861b55780bf776683050434884d2bf7ab8e9830d812116b2cd8c34d358c0205e5ceeb620dfca3ac7761d02d537777429bb01b9c437ce0f1cdf2f7c84290af8f02fcaab123ceee1b0ca0e87e6073601c2d4f4962de50a031680bb3c5c5c137455a9ceff526f49b3d5fd532ae21237ed5adf3afed1321bb17db561b118d119a3730ec9dc17ffb8edc28c50139c9b1635a776a2e9f035779da2d0b21fc5cfc2674d81ef391ef6bee8b0ff1e43e4f16e5d5d1a495be6c395a76f4f6afc1a304b5e16ce81c7e9e91a59b87bf31972a67fcbfccfa7208117d4e9774da54ea88c6f5d9dac8e6f3ac51cf411da0715fba949e91d0542c2aa9b71a45a41b21645bdab941fc133ef003bc232fae465656747fbe14ecc255bbd4b0b19760b0b9a7b10bebe67da88cd34112ffaa286db0a5461399645a45ce440a550d7e1ce1f220dd1c8b25e9e74e7b039146b36205acb5342ce57f3d5c8fa56561841433d6c3132aabc0ee34d1740da6814ec68e1fc5475df801e60818476f2091f35fc2e8b4131b625006f8f2906e299a8aa760fc43c9e882106f8914798fd482fe8e081d8d684b5906adb25ad6c6e112125dcf12cac090c17b82dd1d04b8275ac735726ce7b46d6b957562fc7b364c053747112631258316e6d28af2d64aa663fd77c65b05693fa7ec9ec7f1a58dddde1fdf4f10eeed4f0675d685450849fb464e771ea7449516deeeb19e11f799855193cf0432da44a4aad22167d7a6180350f6747f86a04737a1927f6fb730a636316741bd3fb219ea4e1e0ca3ff28a2699bb014d428f612effd684028b5d900018c90edf8bc946a7fb88b0bc28b4934214207be4db5dfcd6f0b48b1603671cd8eb8fb1c7f44d203fa2a65833abd3c36608dcf0bee3320fb6fa6af13d2e7a7bbd66e44db3b9f67877e9c58c883e7470ff4a134fcd5a578b3455504473b4bb9a93c02c6a1dffcafc0eac7d6628430c182d7feaa7ef6548052c91f9574129d27d8afc56ecd1596310d20df1c8e408a746f1a06779f121213755ec25635dc8af43a79f91b39009f91f7305a9681142f2d0ffcde6d7144f89b215b5e83e045973274a6ffd1dc1b01efb65023d38af0ad9e6d46f0207f5211f3792aaa24efa9f10d723edd742170b4d66b40aec4261801e53af5b4115c6fd2273d1b52dca62d7981e5dc7591f6df04d98184f081ab4b5b1089bc5a2bf0b490a6ea22b2a99e9c2da0e2ec64f35b3f0e8ada3a64a3d35e640c7b3d81666a64780f9d0ab738042d071a12c8b9682ced320edfa7598aea28f230a2112b034a2181da8114552cd8102e0fd64cacc655b5b0aba910690c80af0402517a38b91b72cc631a29b4c6e1d9ecd4e141d60ecd0a23dbeacd65bf4fe51c5005e87c28615fc53d22ffa62af1c834816ff151440dcf21f9af19f3141855569724bbf8eef7979a08247c6e689ad1e047a7cc0bb802fa5ae5df95ba261b335d1a2da55e8153ef167e2908fe14fcd6dbc383930855f61ca9961225410743b727dc705d6a7137556be420e2ef916a361c580a381227358e503df86357407dc8f9ed520d9905445b273c4dc87cbe0f4c9c718239f3a346aa74546c804b5e40543d904b557a7e1462989495c93e90b866fcb4a46c97637e6b65f37b7eaf80c870ed72bbce1fff8c2d87";

    std::vector<byte> plaintext_data = base_conversions::hex_to_bytes(plaintext_str);
    std::vector<byte> key(key_str.begin(), key_str.end());
    std::vector<byte> ciphertext_data = crypto_utils::aes_ecb_encrypt(plaintext_data, key, 128);
    std::string ciphertext_hex = base_conversions::bytes_to_hex(ciphertext_data);
    EXPECT_EQ(ciphertext_hex, expected_ciphertext_str);
}


TEST(CryptoUtils, aes_cbc_decrypt)
{
    std::string ciphertext_str = "091230aade3eb330dbaa4358f88d2a6cd5cf8355cb6823397ad43906df4344557fc4837693c1a8ee3b40acb2323fad396f4ef50cbf02f853d84873973e430c3053c02a6f8db2ed2708131056df66965b876d513fca5e956810a336e386bc767d598bede75b91fe5925659d0e6ea0f951a0b5aeea59c0210ae292167fa250e294f23e3ca23ed297839e05350bdb5481dea2d506da41c4bc7192ff0d93b78138db113055f8b6f49df2a743bf4dc2fb6a845921c263315e2ac58feebd92c6b23a35fc8ca1b50a77bd8d274b32631a068b617a6f467f13680704b47ddca997a7068a31047dccc4d8c3fd355fdcd6acb445869ea786a7ed03f5b431ff72f4fb14dffa4d958c10eb57d1cf5cd10b4603cdd0c94da3bf69da01305a37d36f1d8a6c5ea1b60b1b1a008c67afe20ac872dd1f3f69bc6497c78afd57c219f03a6d0424aacf756e0b13d118315d25b38e3be1e1e5d34a5f316283030866b6a2937f6fa43631d7ef5bbac4be9e66c0939f4050ed92fe0ce5c1443b7b23994f4c45e4670a9bda946ddaae4d170b9f3dae6fb8da30b8fe815651dc2f9331a449ea1a6c025d1090a27e1bed1a8b1882f4030115283534003b5f826e7c1d2a703f59b439f52f4c53ad5029c612ba4fa32b99c0303a2dd9d3e6bf16487aa6c1e9ac75207d1c755c7ba81fd9d85949fd4f76ef11a60bf454170a1740346a2f4e4bdb6c04885f391cac765d1541d05ee47a09705ff925e2081ae6b93762b67b55b2273e9c54ce011a138f810e812a6effeb60cb9a78eb8122455c866cd7c25a4f391c1b374fd150bf3dc7038928241064cf01d58b183aa78bdc71b129fa45a3b92602b5d244a4474e85ee0600ead3b292fe3c5a4b56b53dacffb6f6078cbc706343adde44be72705eabf14648d2ff7c55772766bc795bf276c29ab775d94b758a70d363636644635ac781c18be5b8551ecebb6f16ff2064257b263e1302eebf9794c12df096326419c59e16196ac4d5d0e8d0d3cd1365052d16e0290d88304c7a009c3a53ca0b664b1b0d9e8e0af6bada0d7e646d7a1afedcb0212cc5632f23d2450ff30e11e35eef8a9ade1e9664e6a8b80052c9223a22d8a6bd3323b3dbe31b0491cc51157f6b2b2e5657b361275951ec12b26a53bde235882f89099a1e06a141213bebc308db56e3d3c481092e9dd57cbe6cf129aad41d9d31af87de2f56494c78a7c94b3f294009019480435671fd2e1d363d47b9c859cc30e6fe713f6370de0e184d530a608267ac2c3c45b6a249fc1467f1c83033afd23050d65278645ffb7ca89ac7a6173106302621d216c438b677bf0b03ac6110f53035d3cf854ac972ee61be10d55dc71e64b6beac91269f869fb479bafd0d3a587eddab845a68978f3fa587bd00e9cd924e20c4848ac0297e1dd0bc7a9d6e2c9b65dc84af3fb25e33d794a586f7490ecfa7f1f866ef19c1ea89b6ff1d47dc0e8b1803b958e31635ee5958e6c89bbd633dd688453798f20e51ed9e08bb9d642015c0cd7d287bed30d3ce5b54a7d3674894a034e3b0a1248d59a766ebe0206d77d0357ea8245694e0b42202c44d6bbbd7ffd8d17e2eb9e6ebee8cce286f5f7d099571125b35d1423da487a601043ccffdeb810ddec8bf9f562cb3b543e0ff622fc4e1ef79ec44e28c07e05a3f6d196164ad266086a6571b1100306e0651aac756f43ae17802865981433877cbf78b252e7de874410a8e92f24afecbe46079f799fe099546f631382d450358759283460177434209699b8cc8f585b1235361ab968cc56a9e3d001031e1e9050c17c6d72ccd231b000d3feaf8c8f74a24db2864ca6e5685012585a70d357ef08bdee998018b81046cf6cc2d7baa0cca438b85dc2c4d1450f27c56798ee5f007310900eb87ac63642a95d67ee601218e282e7998c47f4f75eff5f9dd96162484622029e660fa0cd06498251134937c9c765cd9ce58c81a4f8f43b5a078986d862b040436e04eea69a8a3572db359646fd569375ba56d72941bf47aa6a614e9b2ad3ca1d403d21a7dfb7289932377e637aff09959e6578fc56e5bd5c0bb83bc68120863ce17c8ba1557cabdd112b3ecabfb50040c95dfa7a87478d114b0cde05da2429271a19edddac2d8357d2522c2961f0ca671c293ce614b9eafc5a2f95083b16b14a6433186146a38129a41a043406fa4549bba68f1659d23d04138b58712f08b497446bdfcc64afe94753b8b1f0b78956036c41db716e8bc4de2ef3dd9713158eee26423d8fd1349ae0cdf71f32fd8376e6b9bacd42d868e8d4a0fffb15066c4a0c4f214bd4897904abe154da1d05a800bb1f5f1caf765ae71e5da70e67c1ac0c02b2a8a86f6a961a9cdf8957574658c142eee7c108985212f3e9084c5baeee339e4976c181b871f3318fa9abd15de8aed2d6c9774816b3e62030bcd7b5021b42e55910d331252641e1ac3994f038bebd5f141b22538ba78ce128fd7020c2b4dcd30d149dd2453ef5d1af722be6b16820439d468fbaa2ce434a593cd92067523c1b8deec15acc5632456160ee9b386526e15c5c2965eeda353ae93c505481f2ed61e4b4c8e2a1595625d642e47ab48352c78359d64a68cf63673fa1d66a37e741042e75742b78a22e542a62ad53982366c4524dc4e57e119477a0d8e13a770998478d0447e256618346c5fe8a0f4f12232ca2b8af4fb2474972463a88604636ec724c8590d7143c41410d5491422102f5da703581da96f7632792423b7c8ff5926d063a4f374babc4ab7998ae316717990938107df1bbc6cfb0795cbd123e07783129e2e7c2b549a952e47f79b67121a75908522c66e702d8103c0eb3eeede019b06646d3f42a70075922bbabaa273286131fe6f98858c289546acd4055cd144a8c02f8adc2f69d8795e847373e59dba11cc9c192230fa8bb58275cc4446be1654e8ce057e1f861294895be59a572ef029088929d910d1d90a9238d72a6856a55aac7a6a87668ffcf4badb8c9fc71d8ddc2d9c8bb548b87dc371261c6935c42a1cff3d12c95e44605655b19fb42e6892730efa41a059dda11bb5f970acba9fc0b642e276c4973054e8ff629aef7f7e060603b91b75984f44cae63208ca313bfdbbb27d5058c31dd63b5cbfc65ee3631a338cbf3e100ca7645f0a855900b512d8aed7ace2e5decf4b0c539d4ab7c3f0678c72205b7cb1a85c3befe4eaaad12fcebe37480fde1431c69da6748db22b2dfe4709255d30b5119f00b1b6f94298cc48ffd933a237be54951bc0e578307ea6a33af988217c9b6dd871a639d2074e17de263cd9335261398b2c0cd9957daf995f48291462999d92a73369bcb29e07c943848c86cc65dd8b29d08c530d7158d9966587b07ede22d00a5a60b03647ae01f1708abe134c6ae01b5a4c8deed703b90c4fcdb57186cb4a23c0c2d942d309bbec5d136bb8dd32b2e330edbdfb5f79f0213358f77375fa8ace57c1cec6dad3e752ea6716fd84c7681e1b0f25de72164193fdf97d483ee2078c8fa3c14ea2cd3565c15fdddd142edf37275af8bb7d715267961222ffad5faf42b3c4e79734a81e3ca382dd1cfe7d6c3b066e7c16561381180deb7c855922a5e2c31fce285a42ad11f0d31020e8f3b8c97721ee68cd26becbd838cf9d9145cebd9789f8ab37f4684ad5fc111eec5af34725a1e0f9038f9c32e4409a45b7ceeeb6ecd441e5b2116f5df1a52dd11f3f690aa53f54df634a67887e1abf729aa67a8ac6f529f368bf5af0d0a4aa60d3fe132582c8b449dc470e61dbd5c156febc88b2cf19d176e801def37368d9631c6e72a442506932e984842794fd36c5c06930d24debd6e28d5b6701237f4cb579a1c62fb6758f4c12aedcec8e91c7e531a1c21148073d6d1f9867e57788bd4eedf9ceb2af4c3cdfc64257efe289ef677f57e92c34a5afc27ff0bcc399b1ad8410e7dd0a2766a2a974dbb212e57bd21f29d0b6f166c341d393d517b7c1dd54d4ea71dcbf8d41665e95cd3f65af9fc3eb5360e19242335a143947177fbe7336410afd0b16b627d197115de418389957dd3e3c20d254663856017ccbb19e748d61";
    std::string key_str = "YELLOW SUBMARINE";
    std::vector<byte> IV(key_str.size(), '\x00');
    std::string expected_plaintext_str = "49276d206261636b20616e642049276d2072696e67696e27207468652062656c6c200a4120726f636b696e27206f6e20746865206d696b65207768696c652074686520666c79206769726c732079656c6c200a496e206563737461737920696e20746865206261636b206f66206d65200a57656c6c20746861742773206d7920444a204465736861792063757474696e2720616c6c207468656d205a2773200a48697474696e27206861726420616e6420746865206769726c69657320676f696e27206372617a79200a56616e696c6c612773206f6e20746865206d696b652c206d616e2049276d206e6f74206c617a792e200a0a49276d206c657474696e27206d792064727567206b69636b20696e200a497420636f6e74726f6c73206d79206d6f75746820616e64204920626567696e200a546f206a757374206c657420697420666c6f772c206c6574206d7920636f6e636570747320676f200a4d7920706f737365277320746f2074686520736964652079656c6c696e272c20476f2056616e696c6c6120476f21200a0a536d6f6f74682027636175736520746861742773207468652077617920492077696c6c206265200a416e6420696620796f7520646f6e2774206769766520612064616d6e2c207468656e200a57687920796f752073746172696e27206174206d65200a536f20676574206f666620276361757365204920636f6e74726f6c20746865207374616765200a54686572652773206e6f2064697373696e2720616c6c6f776564200a49276d20696e206d79206f776e207068617365200a546865206769726c69657320736120792074686579206c6f7665206d6520616e642074686174206973206f6b200a416e6420492063616e2064616e636520626574746572207468616e20616e79206b6964206e2720706c6179200a0a53746167652032202d2d2059656120746865206f6e65207961272077616e6e61206c697374656e20746f200a49742773206f6666206d79206865616420736f206c657420746865206265617420706c6179207468726f756768200a536f20492063616e2066756e6b20697420757020616e64206d616b6520697420736f756e6420676f6f64200a312d322d3320596f202d2d204b6e6f636b206f6e20736f6d6520776f6f64200a466f7220676f6f64206c75636b2c2049206c696b65206d79207268796d6573206174726f63696f7573200a537570657263616c6166726167696c697374696365787069616c69646f63696f7573200a49276d20616e2065666665637420616e64207468617420796f752063616e20626574200a492063616e2074616b65206120666c79206769726c20616e64206d616b6520686572207765742e200a0a49276d206c696b652053616d736f6e202d2d2053616d736f6e20746f2044656c696c6168200a54686572652773206e6f2064656e79696e272c20596f752063616e2074727920746f2068616e67200a42757420796f75276c6c206b65657020747279696e2720746f20676574206d79207374796c65200a4f76657220616e64206f7665722c207072616374696365206d616b65732070657266656374200a427574206e6f7420696620796f752772652061206c6f616665722e200a0a596f75276c6c20676574206e6f77686572652c206e6f20706c6163652c206e6f2074696d652c206e6f206769726c73200a536f6f6e202d2d204f68206d7920476f642c20686f6d65626f64792c20796f752070726f6261626c7920656174200a537061676865747469207769746820612073706f6f6e2120436f6d65206f6e20616e642073617920697421200a0a5649502e2056616e696c6c6120496365207965702c207965702c2049276d20636f6d696e272068617264206c696b652061207268696e6f200a496e746f7869636174696e6720736f20796f752073746167676572206c696b6520612077696e6f200a536f2070756e6b732073746f7020747279696e6720616e64206769726c2073746f7020637279696e27200a56616e696c6c61204963652069732073656c6c696e2720616e6420796f752070656f706c652061726520627579696e27200a274361757365207768792074686520667265616b7320617265206a6f636b696e27206c696b65204372617a7920476c7565200a4d6f76696e2720616e642067726f6f76696e2720747279696e6720746f2073696e6720616c6f6e67200a416c6c207468726f756768207468652067686574746f2067726f6f76696e272074686973206865726520736f6e67200a4e6f7720796f7527726520616d617a6564206279207468652056495020706f7373652e200a0a5374657070696e2720736f2068617264206c696b652061204765726d616e204e617a69200a53746172746c6564206279207468652062617365732068697474696e272067726f756e64200a54686572652773206e6f207472697070696e27206f6e206d696e652c2049276d206a7573742067657474696e2720646f776e200a537061726b616d617469632c2049276d2068616e67696e27207469676874206c696b6520612066616e61746963200a596f752074726170706564206d65206f6e636520616e6420492074686f756768742074686174200a596f75206d696768742068617665206974200a536f207374657020646f776e20616e64206c656e64206d6520796f757220656172200a27383920696e206d792074696d652120596f752c20273930206973206d7920796561722e200a0a596f75277265207765616b656e696e2720666173742c20594f2120616e6420492063616e2074656c6c206974200a596f757220626f647927732067657474696e2720686f742c20736f2c20736f20492063616e20736d656c6c206974200a536f20646f6e2774206265206d616420616e6420646f6e277420626520736164200a27436175736520746865206c79726963732062656c6f6e6720746f204943452c20596f752063616e2063616c6c206d6520446164200a596f75277265207069746368696e272061206669742c20736f2073746570206261636b20616e6420656e64757265200a4c65742074686520776974636820646f63746f722c204963652c20646f207468652064616e636520746f2063757265200a536f20636f6d6520757020636c6f736520616e6420646f6e277420626520737175617265200a596f752077616e6e6120626174746c65206d65202d2d20416e7974696d652c20616e797768657265200a0a596f752074686f756768742074686174204920776173207765616b2c20426f792c20796f7527726520646561642077726f6e67200a536f20636f6d65206f6e2c206576657279626f647920616e642073696e67207468697320736f6e67200a0a536179202d2d20506c617920746861742066756e6b79206d75736963205361792c20676f20776869746520626f792c20676f20776869746520626f7920676f200a706c617920746861742066756e6b79206d7573696320476f20776869746520626f792c20676f20776869746520626f792c20676f200a4c617920646f776e20616e6420626f6f67696520616e6420706c617920746861742066756e6b79206d757369632074696c6c20796f75206469652e200a0a506c617920746861742066756e6b79206d7573696320436f6d65206f6e2c20436f6d65206f6e2c206c6574206d652068656172200a506c617920746861742066756e6b79206d7573696320776869746520626f7920796f75207361792069742c20736179206974200a506c617920746861742066756e6b79206d757369632041206c6974746c65206c6f75646572206e6f77200a506c617920746861742066756e6b79206d757369632c20776869746520626f7920436f6d65206f6e2c20436f6d65206f6e2c20436f6d65206f6e200a506c617920746861742066756e6b79206d75736963200a04040404";

    std::vector<byte> ciphertext_data = base_conversions::hex_to_bytes(ciphertext_str);
    std::vector<byte> key(key_str.begin(), key_str.end());
    std::vector<byte> plaintext_data = crypto_utils::aes_cbc_decrypt(ciphertext_data, key, IV, 128);
    std::string plaintext_hex = base_conversions::bytes_to_hex(plaintext_data);
    EXPECT_EQ(plaintext_hex, expected_plaintext_str);
}

TEST(CryptoUtils, aes_cbc_encrypt)
{
    std::string plaintext_str = "49276d206261636b20616e642049276d2072696e67696e27207468652062656c6c200a4120726f636b696e27206f6e20746865206d696b65207768696c652074686520666c79206769726c732079656c6c200a496e206563737461737920696e20746865206261636b206f66206d65200a57656c6c20746861742773206d7920444a204465736861792063757474696e2720616c6c207468656d205a2773200a48697474696e27206861726420616e6420746865206769726c69657320676f696e27206372617a79200a56616e696c6c612773206f6e20746865206d696b652c206d616e2049276d206e6f74206c617a792e200a0a49276d206c657474696e27206d792064727567206b69636b20696e200a497420636f6e74726f6c73206d79206d6f75746820616e64204920626567696e200a546f206a757374206c657420697420666c6f772c206c6574206d7920636f6e636570747320676f200a4d7920706f737365277320746f2074686520736964652079656c6c696e272c20476f2056616e696c6c6120476f21200a0a536d6f6f74682027636175736520746861742773207468652077617920492077696c6c206265200a416e6420696620796f7520646f6e2774206769766520612064616d6e2c207468656e200a57687920796f752073746172696e27206174206d65200a536f20676574206f666620276361757365204920636f6e74726f6c20746865207374616765200a54686572652773206e6f2064697373696e2720616c6c6f776564200a49276d20696e206d79206f776e207068617365200a546865206769726c69657320736120792074686579206c6f7665206d6520616e642074686174206973206f6b200a416e6420492063616e2064616e636520626574746572207468616e20616e79206b6964206e2720706c6179200a0a53746167652032202d2d2059656120746865206f6e65207961272077616e6e61206c697374656e20746f200a49742773206f6666206d79206865616420736f206c657420746865206265617420706c6179207468726f756768200a536f20492063616e2066756e6b20697420757020616e64206d616b6520697420736f756e6420676f6f64200a312d322d3320596f202d2d204b6e6f636b206f6e20736f6d6520776f6f64200a466f7220676f6f64206c75636b2c2049206c696b65206d79207268796d6573206174726f63696f7573200a537570657263616c6166726167696c697374696365787069616c69646f63696f7573200a49276d20616e2065666665637420616e64207468617420796f752063616e20626574200a492063616e2074616b65206120666c79206769726c20616e64206d616b6520686572207765742e200a0a49276d206c696b652053616d736f6e202d2d2053616d736f6e20746f2044656c696c6168200a54686572652773206e6f2064656e79696e272c20596f752063616e2074727920746f2068616e67200a42757420796f75276c6c206b65657020747279696e2720746f20676574206d79207374796c65200a4f76657220616e64206f7665722c207072616374696365206d616b65732070657266656374200a427574206e6f7420696620796f752772652061206c6f616665722e200a0a596f75276c6c20676574206e6f77686572652c206e6f20706c6163652c206e6f2074696d652c206e6f206769726c73200a536f6f6e202d2d204f68206d7920476f642c20686f6d65626f64792c20796f752070726f6261626c7920656174200a537061676865747469207769746820612073706f6f6e2120436f6d65206f6e20616e642073617920697421200a0a5649502e2056616e696c6c6120496365207965702c207965702c2049276d20636f6d696e272068617264206c696b652061207268696e6f200a496e746f7869636174696e6720736f20796f752073746167676572206c696b6520612077696e6f200a536f2070756e6b732073746f7020747279696e6720616e64206769726c2073746f7020637279696e27200a56616e696c6c61204963652069732073656c6c696e2720616e6420796f752070656f706c652061726520627579696e27200a274361757365207768792074686520667265616b7320617265206a6f636b696e27206c696b65204372617a7920476c7565200a4d6f76696e2720616e642067726f6f76696e2720747279696e6720746f2073696e6720616c6f6e67200a416c6c207468726f756768207468652067686574746f2067726f6f76696e272074686973206865726520736f6e67200a4e6f7720796f7527726520616d617a6564206279207468652056495020706f7373652e200a0a5374657070696e2720736f2068617264206c696b652061204765726d616e204e617a69200a53746172746c6564206279207468652062617365732068697474696e272067726f756e64200a54686572652773206e6f207472697070696e27206f6e206d696e652c2049276d206a7573742067657474696e2720646f776e200a537061726b616d617469632c2049276d2068616e67696e27207469676874206c696b6520612066616e61746963200a596f752074726170706564206d65206f6e636520616e6420492074686f756768742074686174200a596f75206d696768742068617665206974200a536f207374657020646f776e20616e64206c656e64206d6520796f757220656172200a27383920696e206d792074696d652120596f752c20273930206973206d7920796561722e200a0a596f75277265207765616b656e696e2720666173742c20594f2120616e6420492063616e2074656c6c206974200a596f757220626f647927732067657474696e2720686f742c20736f2c20736f20492063616e20736d656c6c206974200a536f20646f6e2774206265206d616420616e6420646f6e277420626520736164200a27436175736520746865206c79726963732062656c6f6e6720746f204943452c20596f752063616e2063616c6c206d6520446164200a596f75277265207069746368696e272061206669742c20736f2073746570206261636b20616e6420656e64757265200a4c65742074686520776974636820646f63746f722c204963652c20646f207468652064616e636520746f2063757265200a536f20636f6d6520757020636c6f736520616e6420646f6e277420626520737175617265200a596f752077616e6e6120626174746c65206d65202d2d20416e7974696d652c20616e797768657265200a0a596f752074686f756768742074686174204920776173207765616b2c20426f792c20796f7527726520646561642077726f6e67200a536f20636f6d65206f6e2c206576657279626f647920616e642073696e67207468697320736f6e67200a0a536179202d2d20506c617920746861742066756e6b79206d75736963205361792c20676f20776869746520626f792c20676f20776869746520626f7920676f200a706c617920746861742066756e6b79206d7573696320476f20776869746520626f792c20676f20776869746520626f792c20676f200a4c617920646f776e20616e6420626f6f67696520616e6420706c617920746861742066756e6b79206d757369632074696c6c20796f75206469652e200a0a506c617920746861742066756e6b79206d7573696320436f6d65206f6e2c20436f6d65206f6e2c206c6574206d652068656172200a506c617920746861742066756e6b79206d7573696320776869746520626f7920796f75207361792069742c20736179206974200a506c617920746861742066756e6b79206d757369632041206c6974746c65206c6f75646572206e6f77200a506c617920746861742066756e6b79206d757369632c20776869746520626f7920436f6d65206f6e2c20436f6d65206f6e2c20436f6d65206f6e200a506c617920746861742066756e6b79206d75736963200a04040404";
    std::string key_str = "YELLOW SUBMARINE";
    std::vector<byte> IV(key_str.size(), '\x00');
    std::string expected_ciphertext_str = "091230aade3eb330dbaa4358f88d2a6cd5cf8355cb6823397ad43906df4344557fc4837693c1a8ee3b40acb2323fad396f4ef50cbf02f853d84873973e430c3053c02a6f8db2ed2708131056df66965b876d513fca5e956810a336e386bc767d598bede75b91fe5925659d0e6ea0f951a0b5aeea59c0210ae292167fa250e294f23e3ca23ed297839e05350bdb5481dea2d506da41c4bc7192ff0d93b78138db113055f8b6f49df2a743bf4dc2fb6a845921c263315e2ac58feebd92c6b23a35fc8ca1b50a77bd8d274b32631a068b617a6f467f13680704b47ddca997a7068a31047dccc4d8c3fd355fdcd6acb445869ea786a7ed03f5b431ff72f4fb14dffa4d958c10eb57d1cf5cd10b4603cdd0c94da3bf69da01305a37d36f1d8a6c5ea1b60b1b1a008c67afe20ac872dd1f3f69bc6497c78afd57c219f03a6d0424aacf756e0b13d118315d25b38e3be1e1e5d34a5f316283030866b6a2937f6fa43631d7ef5bbac4be9e66c0939f4050ed92fe0ce5c1443b7b23994f4c45e4670a9bda946ddaae4d170b9f3dae6fb8da30b8fe815651dc2f9331a449ea1a6c025d1090a27e1bed1a8b1882f4030115283534003b5f826e7c1d2a703f59b439f52f4c53ad5029c612ba4fa32b99c0303a2dd9d3e6bf16487aa6c1e9ac75207d1c755c7ba81fd9d85949fd4f76ef11a60bf454170a1740346a2f4e4bdb6c04885f391cac765d1541d05ee47a09705ff925e2081ae6b93762b67b55b2273e9c54ce011a138f810e812a6effeb60cb9a78eb8122455c866cd7c25a4f391c1b374fd150bf3dc7038928241064cf01d58b183aa78bdc71b129fa45a3b92602b5d244a4474e85ee0600ead3b292fe3c5a4b56b53dacffb6f6078cbc706343adde44be72705eabf14648d2ff7c55772766bc795bf276c29ab775d94b758a70d363636644635ac781c18be5b8551ecebb6f16ff2064257b263e1302eebf9794c12df096326419c59e16196ac4d5d0e8d0d3cd1365052d16e0290d88304c7a009c3a53ca0b664b1b0d9e8e0af6bada0d7e646d7a1afedcb0212cc5632f23d2450ff30e11e35eef8a9ade1e9664e6a8b80052c9223a22d8a6bd3323b3dbe31b0491cc51157f6b2b2e5657b361275951ec12b26a53bde235882f89099a1e06a141213bebc308db56e3d3c481092e9dd57cbe6cf129aad41d9d31af87de2f56494c78a7c94b3f294009019480435671fd2e1d363d47b9c859cc30e6fe713f6370de0e184d530a608267ac2c3c45b6a249fc1467f1c83033afd23050d65278645ffb7ca89ac7a6173106302621d216c438b677bf0b03ac6110f53035d3cf854ac972ee61be10d55dc71e64b6beac91269f869fb479bafd0d3a587eddab845a68978f3fa587bd00e9cd924e20c4848ac0297e1dd0bc7a9d6e2c9b65dc84af3fb25e33d794a586f7490ecfa7f1f866ef19c1ea89b6ff1d47dc0e8b1803b958e31635ee5958e6c89bbd633dd688453798f20e51ed9e08bb9d642015c0cd7d287bed30d3ce5b54a7d3674894a034e3b0a1248d59a766ebe0206d77d0357ea8245694e0b42202c44d6bbbd7ffd8d17e2eb9e6ebee8cce286f5f7d099571125b35d1423da487a601043ccffdeb810ddec8bf9f562cb3b543e0ff622fc4e1ef79ec44e28c07e05a3f6d196164ad266086a6571b1100306e0651aac756f43ae17802865981433877cbf78b252e7de874410a8e92f24afecbe46079f799fe099546f631382d450358759283460177434209699b8cc8f585b1235361ab968cc56a9e3d001031e1e9050c17c6d72ccd231b000d3feaf8c8f74a24db2864ca6e5685012585a70d357ef08bdee998018b81046cf6cc2d7baa0cca438b85dc2c4d1450f27c56798ee5f007310900eb87ac63642a95d67ee601218e282e7998c47f4f75eff5f9dd96162484622029e660fa0cd06498251134937c9c765cd9ce58c81a4f8f43b5a078986d862b040436e04eea69a8a3572db359646fd569375ba56d72941bf47aa6a614e9b2ad3ca1d403d21a7dfb7289932377e637aff09959e6578fc56e5bd5c0bb83bc68120863ce17c8ba1557cabdd112b3ecabfb50040c95dfa7a87478d114b0cde05da2429271a19edddac2d8357d2522c2961f0ca671c293ce614b9eafc5a2f95083b16b14a6433186146a38129a41a043406fa4549bba68f1659d23d04138b58712f08b497446bdfcc64afe94753b8b1f0b78956036c41db716e8bc4de2ef3dd9713158eee26423d8fd1349ae0cdf71f32fd8376e6b9bacd42d868e8d4a0fffb15066c4a0c4f214bd4897904abe154da1d05a800bb1f5f1caf765ae71e5da70e67c1ac0c02b2a8a86f6a961a9cdf8957574658c142eee7c108985212f3e9084c5baeee339e4976c181b871f3318fa9abd15de8aed2d6c9774816b3e62030bcd7b5021b42e55910d331252641e1ac3994f038bebd5f141b22538ba78ce128fd7020c2b4dcd30d149dd2453ef5d1af722be6b16820439d468fbaa2ce434a593cd92067523c1b8deec15acc5632456160ee9b386526e15c5c2965eeda353ae93c505481f2ed61e4b4c8e2a1595625d642e47ab48352c78359d64a68cf63673fa1d66a37e741042e75742b78a22e542a62ad53982366c4524dc4e57e119477a0d8e13a770998478d0447e256618346c5fe8a0f4f12232ca2b8af4fb2474972463a88604636ec724c8590d7143c41410d5491422102f5da703581da96f7632792423b7c8ff5926d063a4f374babc4ab7998ae316717990938107df1bbc6cfb0795cbd123e07783129e2e7c2b549a952e47f79b67121a75908522c66e702d8103c0eb3eeede019b06646d3f42a70075922bbabaa273286131fe6f98858c289546acd4055cd144a8c02f8adc2f69d8795e847373e59dba11cc9c192230fa8bb58275cc4446be1654e8ce057e1f861294895be59a572ef029088929d910d1d90a9238d72a6856a55aac7a6a87668ffcf4badb8c9fc71d8ddc2d9c8bb548b87dc371261c6935c42a1cff3d12c95e44605655b19fb42e6892730efa41a059dda11bb5f970acba9fc0b642e276c4973054e8ff629aef7f7e060603b91b75984f44cae63208ca313bfdbbb27d5058c31dd63b5cbfc65ee3631a338cbf3e100ca7645f0a855900b512d8aed7ace2e5decf4b0c539d4ab7c3f0678c72205b7cb1a85c3befe4eaaad12fcebe37480fde1431c69da6748db22b2dfe4709255d30b5119f00b1b6f94298cc48ffd933a237be54951bc0e578307ea6a33af988217c9b6dd871a639d2074e17de263cd9335261398b2c0cd9957daf995f48291462999d92a73369bcb29e07c943848c86cc65dd8b29d08c530d7158d9966587b07ede22d00a5a60b03647ae01f1708abe134c6ae01b5a4c8deed703b90c4fcdb57186cb4a23c0c2d942d309bbec5d136bb8dd32b2e330edbdfb5f79f0213358f77375fa8ace57c1cec6dad3e752ea6716fd84c7681e1b0f25de72164193fdf97d483ee2078c8fa3c14ea2cd3565c15fdddd142edf37275af8bb7d715267961222ffad5faf42b3c4e79734a81e3ca382dd1cfe7d6c3b066e7c16561381180deb7c855922a5e2c31fce285a42ad11f0d31020e8f3b8c97721ee68cd26becbd838cf9d9145cebd9789f8ab37f4684ad5fc111eec5af34725a1e0f9038f9c32e4409a45b7ceeeb6ecd441e5b2116f5df1a52dd11f3f690aa53f54df634a67887e1abf729aa67a8ac6f529f368bf5af0d0a4aa60d3fe132582c8b449dc470e61dbd5c156febc88b2cf19d176e801def37368d9631c6e72a442506932e984842794fd36c5c06930d24debd6e28d5b6701237f4cb579a1c62fb6758f4c12aedcec8e91c7e531a1c21148073d6d1f9867e57788bd4eedf9ceb2af4c3cdfc64257efe289ef677f57e92c34a5afc27ff0bcc399b1ad8410e7dd0a2766a2a974dbb212e57bd21f29d0b6f166c341d393d517b7c1dd54d4ea71dcbf8d41665e95cd3f65af9fc3eb5360e19242335a143947177fbe7336410afd0b16b627d197115de418389957dd3e3c20d254663856017ccbb19e748d61";

    std::vector<byte> plaintext_data = base_conversions::hex_to_bytes(plaintext_str);
    std::vector<byte> key(key_str.begin(), key_str.end());
    std::vector<byte> ciphertext_data = crypto_utils::aes_cbc_encrypt(plaintext_data, key, IV, 128);
    std::string ciphertext_hex = base_conversions::bytes_to_hex(ciphertext_data);
    EXPECT_EQ(ciphertext_hex, expected_ciphertext_str);
}