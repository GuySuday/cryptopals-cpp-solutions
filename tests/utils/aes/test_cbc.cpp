#include <gtest/gtest.h>

#include <vector> // std::vector
#include <string> // std::string

#include "utils/aes/cbc.hpp"
#include "utils/base_conversions.hpp"
#include "utils/types.hpp" // byte, nibble

TEST(AesCBC, decrypt)
{
    std::string ciphertext_hex_str = "091230aade3eb330dbaa4358f88d2a6cd5cf8355cb6823397ad43906df4344557fc4837693c1a8ee3b40acb2323fad396f4ef50cbf02f853d84873973e430c3053c02a6f8db2ed2708131056df66965b876d513fca5e956810a336e386bc767d598bede75b91fe5925659d0e6ea0f951a0b5aeea59c0210ae292167fa250e294f23e3ca23ed297839e05350bdb5481dea2d506da41c4bc7192ff0d93b78138db113055f8b6f49df2a743bf4dc2fb6a845921c263315e2ac58feebd92c6b23a35fc8ca1b50a77bd8d274b32631a068b617a6f467f13680704b47ddca997a7068a31047dccc4d8c3fd355fdcd6acb445869ea786a7ed03f5b431ff72f4fb14dffa4d958c10eb57d1cf5cd10b4603cdd0c94da3bf69da01305a37d36f1d8a6c5ea1b60b1b1a008c67afe20ac872dd1f3f69bc6497c78afd57c219f03a6d0424aacf756e0b13d118315d25b38e3be1e1e5d34a5f316283030866b6a2937f6fa43631d7ef5bbac4be9e66c0939f4050ed92fe0ce5c1443b7b23994f4c45e4670a9bda946ddaae4d170b9f3dae6fb8da30b8fe815651dc2f9331a449ea1a6c025d1090a27e1bed1a8b1882f4030115283534003b5f826e7c1d2a703f59b439f52f4c53ad5029c612ba4fa32b99c0303a2dd9d3e6bf16487aa6c1e9ac75207d1c755c7ba81fd9d85949fd4f76ef11a60bf454170a1740346a2f4e4bdb6c04885f391cac765d1541d05ee47a09705ff925e2081ae6b93762b67b55b2273e9c54ce011a138f810e812a6effeb60cb9a78eb8122455c866cd7c25a4f391c1b374fd150bf3dc7038928241064cf01d58b183aa78bdc71b129fa45a3b92602b5d244a4474e85ee0600ead3b292fe3c5a4b56b53dacffb6f6078cbc706343adde44be72705eabf14648d2ff7c55772766bc795bf276c29ab775d94b758a70d363636644635ac781c18be5b8551ecebb6f16ff2064257b263e1302eebf9794c12df096326419c59e16196ac4d5d0e8d0d3cd1365052d16e0290d88304c7a009c3a53ca0b664b1b0d9e8e0af6bada0d7e646d7a1afedcb0212cc5632f23d2450ff30e11e35eef8a9ade1e9664e6a8b80052c9223a22d8a6bd3323b3dbe31b0491cc51157f6b2b2e5657b361275951ec12b26a53bde235882f89099a1e06a141213bebc308db56e3d3c481092e9dd57cbe6cf129aad41d9d31af87de2f56494c78a7c94b3f294009019480435671fd2e1d363d47b9c859cc30e6fe713f6370de0e184d530a608267ac2c3c45b6a249fc1467f1c83033afd23050d65278645ffb7ca89ac7a6173106302621d216c438b677bf0b03ac6110f53035d3cf854ac972ee61be10d55dc71e64b6beac91269f869fb479bafd0d3a587eddab845a68978f3fa587bd00e9cd924e20c4848ac0297e1dd0bc7a9d6e2c9b65dc84af3fb25e33d794a586f7490ecfa7f1f866ef19c1ea89b6ff1d47dc0e8b1803b958e31635ee5958e6c89bbd633dd688453798f20e51ed9e08bb9d642015c0cd7d287bed30d3ce5b54a7d3674894a034e3b0a1248d59a766ebe0206d77d0357ea8245694e0b42202c44d6bbbd7ffd8d17e2eb9e6ebee8cce286f5f7d099571125b35d1423da487a601043ccffdeb810ddec8bf9f562cb3b543e0ff622fc4e1ef79ec44e28c07e05a3f6d196164ad266086a6571b1100306e0651aac756f43ae17802865981433877cbf78b252e7de874410a8e92f24afecbe46079f799fe099546f631382d450358759283460177434209699b8cc8f585b1235361ab968cc56a9e3d001031e1e9050c17c6d72ccd231b000d3feaf8c8f74a24db2864ca6e5685012585a70d357ef08bdee998018b81046cf6cc2d7baa0cca438b85dc2c4d1450f27c56798ee5f007310900eb87ac63642a95d67ee601218e282e7998c47f4f75eff5f9dd96162484622029e660fa0cd06498251134937c9c765cd9ce58c81a4f8f43b5a078986d862b040436e04eea69a8a3572db359646fd569375ba56d72941bf47aa6a614e9b2ad3ca1d403d21a7dfb7289932377e637aff09959e6578fc56e5bd5c0bb83bc68120863ce17c8ba1557cabdd112b3ecabfb50040c95dfa7a87478d114b0cde05da2429271a19edddac2d8357d2522c2961f0ca671c293ce614b9eafc5a2f95083b16b14a6433186146a38129a41a043406fa4549bba68f1659d23d04138b58712f08b497446bdfcc64afe94753b8b1f0b78956036c41db716e8bc4de2ef3dd9713158eee26423d8fd1349ae0cdf71f32fd8376e6b9bacd42d868e8d4a0fffb15066c4a0c4f214bd4897904abe154da1d05a800bb1f5f1caf765ae71e5da70e67c1ac0c02b2a8a86f6a961a9cdf8957574658c142eee7c108985212f3e9084c5baeee339e4976c181b871f3318fa9abd15de8aed2d6c9774816b3e62030bcd7b5021b42e55910d331252641e1ac3994f038bebd5f141b22538ba78ce128fd7020c2b4dcd30d149dd2453ef5d1af722be6b16820439d468fbaa2ce434a593cd92067523c1b8deec15acc5632456160ee9b386526e15c5c2965eeda353ae93c505481f2ed61e4b4c8e2a1595625d642e47ab48352c78359d64a68cf63673fa1d66a37e741042e75742b78a22e542a62ad53982366c4524dc4e57e119477a0d8e13a770998478d0447e256618346c5fe8a0f4f12232ca2b8af4fb2474972463a88604636ec724c8590d7143c41410d5491422102f5da703581da96f7632792423b7c8ff5926d063a4f374babc4ab7998ae316717990938107df1bbc6cfb0795cbd123e07783129e2e7c2b549a952e47f79b67121a75908522c66e702d8103c0eb3eeede019b06646d3f42a70075922bbabaa273286131fe6f98858c289546acd4055cd144a8c02f8adc2f69d8795e847373e59dba11cc9c192230fa8bb58275cc4446be1654e8ce057e1f861294895be59a572ef029088929d910d1d90a9238d72a6856a55aac7a6a87668ffcf4badb8c9fc71d8ddc2d9c8bb548b87dc371261c6935c42a1cff3d12c95e44605655b19fb42e6892730efa41a059dda11bb5f970acba9fc0b642e276c4973054e8ff629aef7f7e060603b91b75984f44cae63208ca313bfdbbb27d5058c31dd63b5cbfc65ee3631a338cbf3e100ca7645f0a855900b512d8aed7ace2e5decf4b0c539d4ab7c3f0678c72205b7cb1a85c3befe4eaaad12fcebe37480fde1431c69da6748db22b2dfe4709255d30b5119f00b1b6f94298cc48ffd933a237be54951bc0e578307ea6a33af988217c9b6dd871a639d2074e17de263cd9335261398b2c0cd9957daf995f48291462999d92a73369bcb29e07c943848c86cc65dd8b29d08c530d7158d9966587b07ede22d00a5a60b03647ae01f1708abe134c6ae01b5a4c8deed703b90c4fcdb57186cb4a23c0c2d942d309bbec5d136bb8dd32b2e330edbdfb5f79f0213358f77375fa8ace57c1cec6dad3e752ea6716fd84c7681e1b0f25de72164193fdf97d483ee2078c8fa3c14ea2cd3565c15fdddd142edf37275af8bb7d715267961222ffad5faf42b3c4e79734a81e3ca382dd1cfe7d6c3b066e7c16561381180deb7c855922a5e2c31fce285a42ad11f0d31020e8f3b8c97721ee68cd26becbd838cf9d9145cebd9789f8ab37f4684ad5fc111eec5af34725a1e0f9038f9c32e4409a45b7ceeeb6ecd441e5b2116f5df1a52dd11f3f690aa53f54df634a67887e1abf729aa67a8ac6f529f368bf5af0d0a4aa60d3fe132582c8b449dc470e61dbd5c156febc88b2cf19d176e801def37368d9631c6e72a442506932e984842794fd36c5c06930d24debd6e28d5b6701237f4cb579a1c62fb6758f4c12aedcec8e91c7e531a1c21148073d6d1f9867e57788bd4eedf9ceb2af4c3cdfc64257efe289ef677f57e92c34a5afc27ff0bcc399b1ad8410e7dd0a2766a2a974dbb212e57bd21f29d0b6f166c341d393d517b7c1dd54d4ea71dcbf8d41665e95cd3f65af9fc3eb5360e19242335a143947177fbe7336410afd0b16b627d197115de418389957dd3e3c20d254663856017ccbb19e748d61";
    std::string key_str = "YELLOW SUBMARINE";
    std::vector<byte> IV(key_str.size(), '\x00');
    std::string expected_plaintext_str = "49276d206261636b20616e642049276d2072696e67696e27207468652062656c6c200a4120726f636b696e27206f6e20746865206d696b65207768696c652074686520666c79206769726c732079656c6c200a496e206563737461737920696e20746865206261636b206f66206d65200a57656c6c20746861742773206d7920444a204465736861792063757474696e2720616c6c207468656d205a2773200a48697474696e27206861726420616e6420746865206769726c69657320676f696e27206372617a79200a56616e696c6c612773206f6e20746865206d696b652c206d616e2049276d206e6f74206c617a792e200a0a49276d206c657474696e27206d792064727567206b69636b20696e200a497420636f6e74726f6c73206d79206d6f75746820616e64204920626567696e200a546f206a757374206c657420697420666c6f772c206c6574206d7920636f6e636570747320676f200a4d7920706f737365277320746f2074686520736964652079656c6c696e272c20476f2056616e696c6c6120476f21200a0a536d6f6f74682027636175736520746861742773207468652077617920492077696c6c206265200a416e6420696620796f7520646f6e2774206769766520612064616d6e2c207468656e200a57687920796f752073746172696e27206174206d65200a536f20676574206f666620276361757365204920636f6e74726f6c20746865207374616765200a54686572652773206e6f2064697373696e2720616c6c6f776564200a49276d20696e206d79206f776e207068617365200a546865206769726c69657320736120792074686579206c6f7665206d6520616e642074686174206973206f6b200a416e6420492063616e2064616e636520626574746572207468616e20616e79206b6964206e2720706c6179200a0a53746167652032202d2d2059656120746865206f6e65207961272077616e6e61206c697374656e20746f200a49742773206f6666206d79206865616420736f206c657420746865206265617420706c6179207468726f756768200a536f20492063616e2066756e6b20697420757020616e64206d616b6520697420736f756e6420676f6f64200a312d322d3320596f202d2d204b6e6f636b206f6e20736f6d6520776f6f64200a466f7220676f6f64206c75636b2c2049206c696b65206d79207268796d6573206174726f63696f7573200a537570657263616c6166726167696c697374696365787069616c69646f63696f7573200a49276d20616e2065666665637420616e64207468617420796f752063616e20626574200a492063616e2074616b65206120666c79206769726c20616e64206d616b6520686572207765742e200a0a49276d206c696b652053616d736f6e202d2d2053616d736f6e20746f2044656c696c6168200a54686572652773206e6f2064656e79696e272c20596f752063616e2074727920746f2068616e67200a42757420796f75276c6c206b65657020747279696e2720746f20676574206d79207374796c65200a4f76657220616e64206f7665722c207072616374696365206d616b65732070657266656374200a427574206e6f7420696620796f752772652061206c6f616665722e200a0a596f75276c6c20676574206e6f77686572652c206e6f20706c6163652c206e6f2074696d652c206e6f206769726c73200a536f6f6e202d2d204f68206d7920476f642c20686f6d65626f64792c20796f752070726f6261626c7920656174200a537061676865747469207769746820612073706f6f6e2120436f6d65206f6e20616e642073617920697421200a0a5649502e2056616e696c6c6120496365207965702c207965702c2049276d20636f6d696e272068617264206c696b652061207268696e6f200a496e746f7869636174696e6720736f20796f752073746167676572206c696b6520612077696e6f200a536f2070756e6b732073746f7020747279696e6720616e64206769726c2073746f7020637279696e27200a56616e696c6c61204963652069732073656c6c696e2720616e6420796f752070656f706c652061726520627579696e27200a274361757365207768792074686520667265616b7320617265206a6f636b696e27206c696b65204372617a7920476c7565200a4d6f76696e2720616e642067726f6f76696e2720747279696e6720746f2073696e6720616c6f6e67200a416c6c207468726f756768207468652067686574746f2067726f6f76696e272074686973206865726520736f6e67200a4e6f7720796f7527726520616d617a6564206279207468652056495020706f7373652e200a0a5374657070696e2720736f2068617264206c696b652061204765726d616e204e617a69200a53746172746c6564206279207468652062617365732068697474696e272067726f756e64200a54686572652773206e6f207472697070696e27206f6e206d696e652c2049276d206a7573742067657474696e2720646f776e200a537061726b616d617469632c2049276d2068616e67696e27207469676874206c696b6520612066616e61746963200a596f752074726170706564206d65206f6e636520616e6420492074686f756768742074686174200a596f75206d696768742068617665206974200a536f207374657020646f776e20616e64206c656e64206d6520796f757220656172200a27383920696e206d792074696d652120596f752c20273930206973206d7920796561722e200a0a596f75277265207765616b656e696e2720666173742c20594f2120616e6420492063616e2074656c6c206974200a596f757220626f647927732067657474696e2720686f742c20736f2c20736f20492063616e20736d656c6c206974200a536f20646f6e2774206265206d616420616e6420646f6e277420626520736164200a27436175736520746865206c79726963732062656c6f6e6720746f204943452c20596f752063616e2063616c6c206d6520446164200a596f75277265207069746368696e272061206669742c20736f2073746570206261636b20616e6420656e64757265200a4c65742074686520776974636820646f63746f722c204963652c20646f207468652064616e636520746f2063757265200a536f20636f6d6520757020636c6f736520616e6420646f6e277420626520737175617265200a596f752077616e6e6120626174746c65206d65202d2d20416e7974696d652c20616e797768657265200a0a596f752074686f756768742074686174204920776173207765616b2c20426f792c20796f7527726520646561642077726f6e67200a536f20636f6d65206f6e2c206576657279626f647920616e642073696e67207468697320736f6e67200a0a536179202d2d20506c617920746861742066756e6b79206d75736963205361792c20676f20776869746520626f792c20676f20776869746520626f7920676f200a706c617920746861742066756e6b79206d7573696320476f20776869746520626f792c20676f20776869746520626f792c20676f200a4c617920646f776e20616e6420626f6f67696520616e6420706c617920746861742066756e6b79206d757369632074696c6c20796f75206469652e200a0a506c617920746861742066756e6b79206d7573696320436f6d65206f6e2c20436f6d65206f6e2c206c6574206d652068656172200a506c617920746861742066756e6b79206d7573696320776869746520626f7920796f75207361792069742c20736179206974200a506c617920746861742066756e6b79206d757369632041206c6974746c65206c6f75646572206e6f77200a506c617920746861742066756e6b79206d757369632c20776869746520626f7920436f6d65206f6e2c20436f6d65206f6e2c20436f6d65206f6e200a506c617920746861742066756e6b79206d75736963200a04040404";

    std::vector<nibble> ciphertext_hex(ciphertext_hex_str.begin(), ciphertext_hex_str.end());
    std::vector<nibble> expected_plaintext(expected_plaintext_str.begin(), expected_plaintext_str.end());

    std::vector<byte> ciphertext_data = base_conversions::hex_to_bytes(ciphertext_hex);
    std::vector<byte> key(key_str.begin(), key_str.end());
    std::vector<byte> plaintext_data = aes::cbc::decrypt(ciphertext_data, key, IV, 128);
    std::vector<nibble> plaintext_hex = base_conversions::bytes_to_hex(plaintext_data);
    EXPECT_EQ(plaintext_hex, expected_plaintext);
}

TEST(AesCBC, encrypt)
{
    std::string plaintext_str = "49276d206261636b20616e642049276d2072696e67696e27207468652062656c6c200a4120726f636b696e27206f6e20746865206d696b65207768696c652074686520666c79206769726c732079656c6c200a496e206563737461737920696e20746865206261636b206f66206d65200a57656c6c20746861742773206d7920444a204465736861792063757474696e2720616c6c207468656d205a2773200a48697474696e27206861726420616e6420746865206769726c69657320676f696e27206372617a79200a56616e696c6c612773206f6e20746865206d696b652c206d616e2049276d206e6f74206c617a792e200a0a49276d206c657474696e27206d792064727567206b69636b20696e200a497420636f6e74726f6c73206d79206d6f75746820616e64204920626567696e200a546f206a757374206c657420697420666c6f772c206c6574206d7920636f6e636570747320676f200a4d7920706f737365277320746f2074686520736964652079656c6c696e272c20476f2056616e696c6c6120476f21200a0a536d6f6f74682027636175736520746861742773207468652077617920492077696c6c206265200a416e6420696620796f7520646f6e2774206769766520612064616d6e2c207468656e200a57687920796f752073746172696e27206174206d65200a536f20676574206f666620276361757365204920636f6e74726f6c20746865207374616765200a54686572652773206e6f2064697373696e2720616c6c6f776564200a49276d20696e206d79206f776e207068617365200a546865206769726c69657320736120792074686579206c6f7665206d6520616e642074686174206973206f6b200a416e6420492063616e2064616e636520626574746572207468616e20616e79206b6964206e2720706c6179200a0a53746167652032202d2d2059656120746865206f6e65207961272077616e6e61206c697374656e20746f200a49742773206f6666206d79206865616420736f206c657420746865206265617420706c6179207468726f756768200a536f20492063616e2066756e6b20697420757020616e64206d616b6520697420736f756e6420676f6f64200a312d322d3320596f202d2d204b6e6f636b206f6e20736f6d6520776f6f64200a466f7220676f6f64206c75636b2c2049206c696b65206d79207268796d6573206174726f63696f7573200a537570657263616c6166726167696c697374696365787069616c69646f63696f7573200a49276d20616e2065666665637420616e64207468617420796f752063616e20626574200a492063616e2074616b65206120666c79206769726c20616e64206d616b6520686572207765742e200a0a49276d206c696b652053616d736f6e202d2d2053616d736f6e20746f2044656c696c6168200a54686572652773206e6f2064656e79696e272c20596f752063616e2074727920746f2068616e67200a42757420796f75276c6c206b65657020747279696e2720746f20676574206d79207374796c65200a4f76657220616e64206f7665722c207072616374696365206d616b65732070657266656374200a427574206e6f7420696620796f752772652061206c6f616665722e200a0a596f75276c6c20676574206e6f77686572652c206e6f20706c6163652c206e6f2074696d652c206e6f206769726c73200a536f6f6e202d2d204f68206d7920476f642c20686f6d65626f64792c20796f752070726f6261626c7920656174200a537061676865747469207769746820612073706f6f6e2120436f6d65206f6e20616e642073617920697421200a0a5649502e2056616e696c6c6120496365207965702c207965702c2049276d20636f6d696e272068617264206c696b652061207268696e6f200a496e746f7869636174696e6720736f20796f752073746167676572206c696b6520612077696e6f200a536f2070756e6b732073746f7020747279696e6720616e64206769726c2073746f7020637279696e27200a56616e696c6c61204963652069732073656c6c696e2720616e6420796f752070656f706c652061726520627579696e27200a274361757365207768792074686520667265616b7320617265206a6f636b696e27206c696b65204372617a7920476c7565200a4d6f76696e2720616e642067726f6f76696e2720747279696e6720746f2073696e6720616c6f6e67200a416c6c207468726f756768207468652067686574746f2067726f6f76696e272074686973206865726520736f6e67200a4e6f7720796f7527726520616d617a6564206279207468652056495020706f7373652e200a0a5374657070696e2720736f2068617264206c696b652061204765726d616e204e617a69200a53746172746c6564206279207468652062617365732068697474696e272067726f756e64200a54686572652773206e6f207472697070696e27206f6e206d696e652c2049276d206a7573742067657474696e2720646f776e200a537061726b616d617469632c2049276d2068616e67696e27207469676874206c696b6520612066616e61746963200a596f752074726170706564206d65206f6e636520616e6420492074686f756768742074686174200a596f75206d696768742068617665206974200a536f207374657020646f776e20616e64206c656e64206d6520796f757220656172200a27383920696e206d792074696d652120596f752c20273930206973206d7920796561722e200a0a596f75277265207765616b656e696e2720666173742c20594f2120616e6420492063616e2074656c6c206974200a596f757220626f647927732067657474696e2720686f742c20736f2c20736f20492063616e20736d656c6c206974200a536f20646f6e2774206265206d616420616e6420646f6e277420626520736164200a27436175736520746865206c79726963732062656c6f6e6720746f204943452c20596f752063616e2063616c6c206d6520446164200a596f75277265207069746368696e272061206669742c20736f2073746570206261636b20616e6420656e64757265200a4c65742074686520776974636820646f63746f722c204963652c20646f207468652064616e636520746f2063757265200a536f20636f6d6520757020636c6f736520616e6420646f6e277420626520737175617265200a596f752077616e6e6120626174746c65206d65202d2d20416e7974696d652c20616e797768657265200a0a596f752074686f756768742074686174204920776173207765616b2c20426f792c20796f7527726520646561642077726f6e67200a536f20636f6d65206f6e2c206576657279626f647920616e642073696e67207468697320736f6e67200a0a536179202d2d20506c617920746861742066756e6b79206d75736963205361792c20676f20776869746520626f792c20676f20776869746520626f7920676f200a706c617920746861742066756e6b79206d7573696320476f20776869746520626f792c20676f20776869746520626f792c20676f200a4c617920646f776e20616e6420626f6f67696520616e6420706c617920746861742066756e6b79206d757369632074696c6c20796f75206469652e200a0a506c617920746861742066756e6b79206d7573696320436f6d65206f6e2c20436f6d65206f6e2c206c6574206d652068656172200a506c617920746861742066756e6b79206d7573696320776869746520626f7920796f75207361792069742c20736179206974200a506c617920746861742066756e6b79206d757369632041206c6974746c65206c6f75646572206e6f77200a506c617920746861742066756e6b79206d757369632c20776869746520626f7920436f6d65206f6e2c20436f6d65206f6e2c20436f6d65206f6e200a506c617920746861742066756e6b79206d75736963200a";
    std::string key_str = "YELLOW SUBMARINE";
    std::vector<byte> IV(key_str.size(), '\x00');
    std::string expected_ciphertext_str = "091230aade3eb330dbaa4358f88d2a6cd5cf8355cb6823397ad43906df4344557fc4837693c1a8ee3b40acb2323fad396f4ef50cbf02f853d84873973e430c3053c02a6f8db2ed2708131056df66965b876d513fca5e956810a336e386bc767d598bede75b91fe5925659d0e6ea0f951a0b5aeea59c0210ae292167fa250e294f23e3ca23ed297839e05350bdb5481dea2d506da41c4bc7192ff0d93b78138db113055f8b6f49df2a743bf4dc2fb6a845921c263315e2ac58feebd92c6b23a35fc8ca1b50a77bd8d274b32631a068b617a6f467f13680704b47ddca997a7068a31047dccc4d8c3fd355fdcd6acb445869ea786a7ed03f5b431ff72f4fb14dffa4d958c10eb57d1cf5cd10b4603cdd0c94da3bf69da01305a37d36f1d8a6c5ea1b60b1b1a008c67afe20ac872dd1f3f69bc6497c78afd57c219f03a6d0424aacf756e0b13d118315d25b38e3be1e1e5d34a5f316283030866b6a2937f6fa43631d7ef5bbac4be9e66c0939f4050ed92fe0ce5c1443b7b23994f4c45e4670a9bda946ddaae4d170b9f3dae6fb8da30b8fe815651dc2f9331a449ea1a6c025d1090a27e1bed1a8b1882f4030115283534003b5f826e7c1d2a703f59b439f52f4c53ad5029c612ba4fa32b99c0303a2dd9d3e6bf16487aa6c1e9ac75207d1c755c7ba81fd9d85949fd4f76ef11a60bf454170a1740346a2f4e4bdb6c04885f391cac765d1541d05ee47a09705ff925e2081ae6b93762b67b55b2273e9c54ce011a138f810e812a6effeb60cb9a78eb8122455c866cd7c25a4f391c1b374fd150bf3dc7038928241064cf01d58b183aa78bdc71b129fa45a3b92602b5d244a4474e85ee0600ead3b292fe3c5a4b56b53dacffb6f6078cbc706343adde44be72705eabf14648d2ff7c55772766bc795bf276c29ab775d94b758a70d363636644635ac781c18be5b8551ecebb6f16ff2064257b263e1302eebf9794c12df096326419c59e16196ac4d5d0e8d0d3cd1365052d16e0290d88304c7a009c3a53ca0b664b1b0d9e8e0af6bada0d7e646d7a1afedcb0212cc5632f23d2450ff30e11e35eef8a9ade1e9664e6a8b80052c9223a22d8a6bd3323b3dbe31b0491cc51157f6b2b2e5657b361275951ec12b26a53bde235882f89099a1e06a141213bebc308db56e3d3c481092e9dd57cbe6cf129aad41d9d31af87de2f56494c78a7c94b3f294009019480435671fd2e1d363d47b9c859cc30e6fe713f6370de0e184d530a608267ac2c3c45b6a249fc1467f1c83033afd23050d65278645ffb7ca89ac7a6173106302621d216c438b677bf0b03ac6110f53035d3cf854ac972ee61be10d55dc71e64b6beac91269f869fb479bafd0d3a587eddab845a68978f3fa587bd00e9cd924e20c4848ac0297e1dd0bc7a9d6e2c9b65dc84af3fb25e33d794a586f7490ecfa7f1f866ef19c1ea89b6ff1d47dc0e8b1803b958e31635ee5958e6c89bbd633dd688453798f20e51ed9e08bb9d642015c0cd7d287bed30d3ce5b54a7d3674894a034e3b0a1248d59a766ebe0206d77d0357ea8245694e0b42202c44d6bbbd7ffd8d17e2eb9e6ebee8cce286f5f7d099571125b35d1423da487a601043ccffdeb810ddec8bf9f562cb3b543e0ff622fc4e1ef79ec44e28c07e05a3f6d196164ad266086a6571b1100306e0651aac756f43ae17802865981433877cbf78b252e7de874410a8e92f24afecbe46079f799fe099546f631382d450358759283460177434209699b8cc8f585b1235361ab968cc56a9e3d001031e1e9050c17c6d72ccd231b000d3feaf8c8f74a24db2864ca6e5685012585a70d357ef08bdee998018b81046cf6cc2d7baa0cca438b85dc2c4d1450f27c56798ee5f007310900eb87ac63642a95d67ee601218e282e7998c47f4f75eff5f9dd96162484622029e660fa0cd06498251134937c9c765cd9ce58c81a4f8f43b5a078986d862b040436e04eea69a8a3572db359646fd569375ba56d72941bf47aa6a614e9b2ad3ca1d403d21a7dfb7289932377e637aff09959e6578fc56e5bd5c0bb83bc68120863ce17c8ba1557cabdd112b3ecabfb50040c95dfa7a87478d114b0cde05da2429271a19edddac2d8357d2522c2961f0ca671c293ce614b9eafc5a2f95083b16b14a6433186146a38129a41a043406fa4549bba68f1659d23d04138b58712f08b497446bdfcc64afe94753b8b1f0b78956036c41db716e8bc4de2ef3dd9713158eee26423d8fd1349ae0cdf71f32fd8376e6b9bacd42d868e8d4a0fffb15066c4a0c4f214bd4897904abe154da1d05a800bb1f5f1caf765ae71e5da70e67c1ac0c02b2a8a86f6a961a9cdf8957574658c142eee7c108985212f3e9084c5baeee339e4976c181b871f3318fa9abd15de8aed2d6c9774816b3e62030bcd7b5021b42e55910d331252641e1ac3994f038bebd5f141b22538ba78ce128fd7020c2b4dcd30d149dd2453ef5d1af722be6b16820439d468fbaa2ce434a593cd92067523c1b8deec15acc5632456160ee9b386526e15c5c2965eeda353ae93c505481f2ed61e4b4c8e2a1595625d642e47ab48352c78359d64a68cf63673fa1d66a37e741042e75742b78a22e542a62ad53982366c4524dc4e57e119477a0d8e13a770998478d0447e256618346c5fe8a0f4f12232ca2b8af4fb2474972463a88604636ec724c8590d7143c41410d5491422102f5da703581da96f7632792423b7c8ff5926d063a4f374babc4ab7998ae316717990938107df1bbc6cfb0795cbd123e07783129e2e7c2b549a952e47f79b67121a75908522c66e702d8103c0eb3eeede019b06646d3f42a70075922bbabaa273286131fe6f98858c289546acd4055cd144a8c02f8adc2f69d8795e847373e59dba11cc9c192230fa8bb58275cc4446be1654e8ce057e1f861294895be59a572ef029088929d910d1d90a9238d72a6856a55aac7a6a87668ffcf4badb8c9fc71d8ddc2d9c8bb548b87dc371261c6935c42a1cff3d12c95e44605655b19fb42e6892730efa41a059dda11bb5f970acba9fc0b642e276c4973054e8ff629aef7f7e060603b91b75984f44cae63208ca313bfdbbb27d5058c31dd63b5cbfc65ee3631a338cbf3e100ca7645f0a855900b512d8aed7ace2e5decf4b0c539d4ab7c3f0678c72205b7cb1a85c3befe4eaaad12fcebe37480fde1431c69da6748db22b2dfe4709255d30b5119f00b1b6f94298cc48ffd933a237be54951bc0e578307ea6a33af988217c9b6dd871a639d2074e17de263cd9335261398b2c0cd9957daf995f48291462999d92a73369bcb29e07c943848c86cc65dd8b29d08c530d7158d9966587b07ede22d00a5a60b03647ae01f1708abe134c6ae01b5a4c8deed703b90c4fcdb57186cb4a23c0c2d942d309bbec5d136bb8dd32b2e330edbdfb5f79f0213358f77375fa8ace57c1cec6dad3e752ea6716fd84c7681e1b0f25de72164193fdf97d483ee2078c8fa3c14ea2cd3565c15fdddd142edf37275af8bb7d715267961222ffad5faf42b3c4e79734a81e3ca382dd1cfe7d6c3b066e7c16561381180deb7c855922a5e2c31fce285a42ad11f0d31020e8f3b8c97721ee68cd26becbd838cf9d9145cebd9789f8ab37f4684ad5fc111eec5af34725a1e0f9038f9c32e4409a45b7ceeeb6ecd441e5b2116f5df1a52dd11f3f690aa53f54df634a67887e1abf729aa67a8ac6f529f368bf5af0d0a4aa60d3fe132582c8b449dc470e61dbd5c156febc88b2cf19d176e801def37368d9631c6e72a442506932e984842794fd36c5c06930d24debd6e28d5b6701237f4cb579a1c62fb6758f4c12aedcec8e91c7e531a1c21148073d6d1f9867e57788bd4eedf9ceb2af4c3cdfc64257efe289ef677f57e92c34a5afc27ff0bcc399b1ad8410e7dd0a2766a2a974dbb212e57bd21f29d0b6f166c341d393d517b7c1dd54d4ea71dcbf8d41665e95cd3f65af9fc3eb5360e19242335a143947177fbe7336410afd0b16b627d197115de418389957dd3e3c20d254663856017ccbb19e748d61";

    std::vector<nibble> plaintext(plaintext_str.begin(), plaintext_str.end());
    std::vector<byte> key(key_str.begin(), key_str.end());
    std::vector<nibble> expected_ciphertext(expected_ciphertext_str.begin(), expected_ciphertext_str.end());

    std::vector<byte> plaintext_data = base_conversions::hex_to_bytes(plaintext);
    std::vector<byte> ciphertext_data = aes::cbc::encrypt(plaintext_data, key, IV, 128);
    std::vector<byte> ciphertext_hex = base_conversions::bytes_to_hex(ciphertext_data);
    EXPECT_EQ(ciphertext_hex, expected_ciphertext);
}